{% extends 'layouts.html' %}


{% block title_suffix %}Issues managements{% endblock title_suffix %}

{% block navbar_li %}
    <li><a href="{{ url_for('admin') }}">Admin page</a></li>
    <li><a href="{{ url_for('issues_page') }}">Issues page</a></li>
    <li><a href="{{ url_for('logout') }}">Logout</a></li>
{% endblock navbar_li %}

{% block content %}
<div class="lead row">     
    <div class="col-md-7">  <h1> {{issue.title }} </h1> </div>
    <div class="text-right text-muted col-md-5">
        {%  if issue.delete_date %}
            <small> <i>  Deleted   {{ issue.delete_date.strftime('%Y-%m-%d %H:%M') }} </i> </small>
            <a class="btn btn-success" data-toggle="modal" data-target="#deletion" data-elem-id="{{ issue.id }}"
                data-name="{{ issue.title }}" data-func-name="restore" data-elem-name="issue">Restore</a>
        {% else %}
                <a class="btn btn-danger" data-toggle="modal" data-target="#deletion" data-elem-id="{{ issue.id }}"
                    data-name="{{ issue.title }}" data-func-name="delete" data-elem-name="issue">Delete</a>      
        {% endif %} 
        <a href="{{ url_for('issue_modify', issue_id=issue.id) }}" class="btn btn-primary">Edit</a>
    </div>

    <div class="col-md-12">
        <hr>
        <dl class="dl-horizontal ">
            <dt> Description: </dt>
                <dd> {{ issue.description }}</dd>
            <dt> Category: </dt>
                <dd> {{issue.category.category}} </dd>
            <dt> Owner: </dt>
                <dd> {{issue.user.alias}} </dd>
            <dt> Location: </dt>
                <dd> {{issue.location_lat}}, {{issue.location_lon }}  </dd>
            <dt> Last status: </dt>
                <dd> {{ issue.status }} </dd>
            {% if attachments %}
                <dt> Attachments: </dt>
                {% for attachment in attachments %}
                    <dd> {{ attachment.image_url}} </dd>               
                {% endfor %}
            {% endif %}
        </dl> 
        <hr>
        <ul>
            {% for history in list_history%}
              {% if history[0] == 'change_status' %}
                <li> <i>{{ history[3]}}</i> status changed to <b>{{ history[1] }}</b> by <b> {{ history[2] }} </b></li>
              {% else %}
                <ul>
                    <li type="circle"> <i>{{ history[3]}}  </i> by <b> {{history[1]}} </b> <p> "{{history[2]}}" </li>
                </ul>
              {% endif%}
            {% endfor %}
        </ul>
    </div>
</div>

<div class="modal fade" id="deletion" role="dialog">
        <div class="modal-dialog">

            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body"> </div>
                <div class="modal-footer">
                    <form id="delete-user" method="post" action="#">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <button type="submit" class="btn btn-danger button-confirm"> </button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </form>
                </div>
            </div>

        </div>
      </div>
{% endblock %}